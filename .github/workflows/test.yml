name: Appconfig

on:
  workflow_dispatch:

env:
  AZURE_SOAPAPI_NAME: 'as-onx1-intgapp-dev-001'   # set this to your function app name on Azure
  AZURE_SOAPAPI_PACKAGE_PATH: 'SOAP_APIs'       
  MY_FILE_PATH: "${{ github.workspace }}/SOAP_APIs/appsettings.json"    # set this to the dotnet version to use (e.g.'6.0.x', 8.0.x)

jobs:
 build-and-deploy:
   runs-on: windows-latest
   environment: dev
               
   steps:
   -  run: echo "folder ${{github.workspace}}"
   -  name: 'Checkout GitHub Action'
      uses: actions/checkout@v2
   -  id: getParams
      shell: bash
      run: |
        content=`cat ./SOAP_APIs/appsettings.json`
                  # the following lines are only required for multi line json
        content="${content//'%'/'%25'}"
        content="${content//$'\n'/'%0A'}"
        content="${content//$'\r'/'%0D'}"
            # end of optional handling for multi line json
        echo "::set-output name=packageJson::$content"
                
                #testing output from the previous command
   -  name: echo ServerName
      shell: bash
      run: echo "${{steps.getParams.outputs.packageJson}}"

   - name: Script
     run: $json = Get-Content './SOAP_APIs/appsettings.json' | Out-String | ConvertFrom-Json     
       echo "${{json}}"     
     shell: pwsh
